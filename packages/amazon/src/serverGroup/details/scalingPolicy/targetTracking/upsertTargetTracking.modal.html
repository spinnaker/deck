<div modal-page class="scaling-policy-modal form-inline">
  <task-monitor monitor="$ctrl.taskMonitor"></task-monitor>
  <modal-close dismiss="$dismiss()"></modal-close>
  <div class="modal-header">
    <h4 class="modal-title">{{$ctrl.policy.policyName ? "Update" : "Create"}} scaling policy</h4>
  </div>
  <div class="modal-body">
    <form name="form" novalidate>
      <h4 class="section-heading">Target Metric</h4>
      <target-metric-fields
        allow-dual-mode="true"
        cloudwatch="false"
        command="$ctrl.command"
        is-custom-metric="$ctrl.state.metricType === 'custom'"
        server-group="$ctrl.serverGroup"
        toggle-metric-type="$ctrl.metricTypeChanged"
        unit="$ctrl.state.unit"
        update-command="$ctrl.commandChanged"
        update-unit="$ctrl.updateUnit"
      ></target-metric-fields>
      <h4 class="section-heading">Additional Settings</h4>
      <div class="section-body section-additional-settings">
        <div class="row" ng-if="$ctrl.policy.policyName">
          <div class="col-md-2 sm-label-right">Policy Name</div>
          <div class="col-md-10 content-fields">
            <span class="form-control-static select-placeholder" ng-bind="$ctrl.policy.policyName"></span>
          </div>
        </div>

        <div class="row">
          <div class="col-md-2 sm-label-right">Warmup</div>
          <div class="col-md-10 content-fields">
            <span class="form-control-static select-placeholder">Instances need</span>
            <input
              type="number"
              style="width: 60px"
              class="form-control input-sm"
              required
              ng-model="$ctrl.command.estimatedInstanceWarmup"
            />
            <span class="input-label"> seconds to warm up </span>
          </div>
        </div>

        <div class="row">
          <div class="col-md-2 sm-label-right">Scale In</div>
          <div class="col-md-9">
            <div class="checkbox" style="margin-top: 5px">
              <label>
                <input
                  type="checkbox"
                  ng-model="$ctrl.command.targetTrackingConfiguration.disableScaleIn"
                  ng-change="$ctrl.scaleInChanged()"
                />
                Disable Scale-downs
              </label>
              <div class="small" style="margin-top: 5px">
                <p>
                  This option disables scale-downs for the target tracking policy, while keeping the scale-ups. This
                  means that ASG will not scale down unless you explicitly set up a separate step policy to scale it
                  down.
                </p>
                <p>This is useful when you have special requirements, such as gradual or delayed scale-down.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="row" ng-if="$ctrl.state.scaleInChanged">
          <div class="col-md-10 col-md-offset-1 well">
            <div ng-if="$ctrl.command.targetTrackingConfiguration.disableScaleIn">
              This policy will not scale down. Make sure you have another policy (either TT or Step) that will scale
              down this ASG.
            </div>
            <div ng-if="!$ctrl.command.targetTrackingConfiguration.disableScaleIn">
              This policy will scale both up and down. Make sure you don't have other scaling policies, as they will
              likely interfere with each other.
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button class="btn btn-default" ng-click="$ctrl.cancel()">Cancel</button>
    <submit-button
      is-disabled="!form.$valid || $ctrl.taskMonitor.submitting"
      submitting="$ctrl.taskMonitor.submitting"
      on-click="$ctrl.save()"
      is-new="!$ctrl.policy.policyName"
    ></submit-button>
  </div>
</div>
